#!/usr/bin/env python3
"""
live letter replacer
Logs every problem to log  in the same folder.
Pause/Break  toggles ON/OFF.  Ctrl-C  quits.
"""
import pathlib, traceback, sys, os, time, threading
LOG_FILE = pathlib.Path(__file__).with_suffix(".log")

# ------------------------------------------------------------------------------- #
# 1.  Tables ‚Äì add more if needed                                                 #
# ------------------------------------------------------------------------------- #
MASTER = {
    "bold": {
        'a':'ùêö','b':'ùêõ','c':'ùêú','d':'ùêù','e':'ùêû','f':'ùêü','g':'ùê†','h':'ùê°','i':'ùê¢',
        'j':'ùê£','k':'ùê§','l':'ùê•','m':'ùê¶','n':'ùêß','o':'ùê®','p':'ùê©','q':'ùê™','r':'ùê´',
        's':'ùê¨','t':'ùê≠','u':'ùêÆ','v':'ùêØ','w':'ùê∞','x':'ùê±','y':'ùê≤','z':'ùê≥',
        'A':'ùêÄ','B':'ùêÅ','C':'ùêÇ','D':'ùêÉ','E':'ùêÑ','F':'ùêÖ','G':'ùêÜ','H':'ùêá','I':'ùêà',
        'J':'ùêâ','K':'ùêä','L':'ùêã','M':'ùêå','N':'ùêç','O':'ùêé','P':'ùêè','Q':'ùêê','R':'ùêë',
        'S':'ùêí','T':'ùêì','U':'ùêî','V':'ùêï','W':'ùêñ','X':'ùêó','Y':'ùêò','Z':'ùêô'
    },
"sans": {
        'a':'ùóÆ',
        'b':'ùóØ',
        'c':'ùó∞',
        'd':'ùó±',
        'e':'ùó≤',
        'f':'ùó≥',
        'g':'ùó¥',
        'h':'ùóµ',
        'i':'ùó∂',
        'j':'ùó∑',
        'k':'ùó∏',
        'l':'ùóπ',
        'm':'ùó∫',
        'n':'ùóª',
        'o':'ùóº',
        'p':'ùóΩ',
        'q':'ùóæ',
        'r':'ùóø',
        's':'ùòÄ',
        't':'ùòÅ',
        'u':'ùòÇ',
        'v':'ùòÉ',
        'w':'ùòÑ',
        'x':'ùòÖ',
        'y':'ùòÜ',
        'z':'ùòá',
        'A':'ùóî',
        'B':'ùóï',
        'C':'ùóñ',
        'D':'ùóó',
        'E':'ùóò',
        'F':'ùóô',
        'G':'ùóö',
        'H':'ùóõ',
        'I':'ùóú',
        'J':'ùóù',
        'K':'ùóû',
        'L':'ùóü',
        'M':'ùó†',
        'N':'ùó°',
        'O':'ùó¢',
        'P':'ùó£',
        'Q':'ùó§',
        'R':'ùó•',
        'S':'ùó¶',
        'T':'ùóß',
        'U':'ùó®',
        'V':'ùó©',
        'W':'ùó™',
        'X':'ùó´',
        'Y':'ùó¨',
        'Z':'ùó≠'
    },
    "box": {
        'a':'üÑ∞',
        'b':'üÑ±',
        'c':'üÑ≤',
        'd':'üÑ≥',
        'e':'üÑ¥',
        'f':'üÑµ',
        'g':'üÑ∂',
        'h':'üÑ∑',
        'i':'üÑ∏',
        'j':'üÑπ',
        'k':'üÑ∫',
        'l':'üÑª',
        'm':'üÑº',
        'n':'üÑΩ',
        'o':'üÑæ',
        'p':'üÑø',
        'q':'üÖÄ',
        'r':'üÖÅ',
        's':'üÖÇ',
        't':'üÖÉ',
        'u':'üÖÑ',
        'v':'üÖÖ',
        'w':'üÖÜ',
        'x':'üÖá',
        'y':'üÖà',
        'z':'üÖâ',
        'A':'üÑ∞',
        'B':'üÑ±',
        'C':'üÑ≤',
        'D':'üÑ≥',
        'E':'üÑ¥',
        'F':'üÑµ',
        'G':'üÑ∂',
        'H':'üÑ∑',
        'I':'üÑ∏',
        'J':'üÑπ',
        'K':'üÑ∫',
        'L':'üÑª',
        'M':'üÑº',
        'N':'üÑΩ',
        'O':'üÑæ',
        'P':'üÑø',
        'Q':'üÖÄ',
        'R':'üÖÅ',
        'S':'üÖÇ',
        'T':'üÖÉ',
        'U':'üÖÑ',
        'V':'üÖÖ',
        'W':'üÖÜ',
        'X':'üÖá',
        'Y':'üÖà',
        'Z':'üÖâ'
    },
    "square": {
        'a':'üÖ∞',
        'b':'üÖ±',
        'c':'üÖ≤',
        'd':'üÖ≥',
        'e':'üÖ¥',
        'f':'üÖµ',
        'g':'üÖ∂',
        'h':'üÖ∑',
        'i':'üÖ∏',
        'j':'üÖπ',
        'k':'üÖ∫',
        'l':'üÖª',
        'm':'üÖº',
        'n':'üÖΩ',
        'o':'üÖæ',
        'p':'üÖø',
        'q':'üÜÄ',
        'r':'üÜÅ',
        's':'üÜÇ',
        't':'üÜÉ',
        'u':'üÜÑ',
        'v':'üÜÖ',
        'w':'üÜÜ',
        'x':'üÜá',
        'y':'üÜà',
        'z':'üÜâ',
        'A':'üÖ∞',
        'B':'üÖ±',
        'C':'üÖ≤',
        'D':'üÖ≥',
        'E':'üÖ¥',
        'F':'üÖµ',
        'G':'üÖ∂',
        'H':'üÖ∑',
        'I':'üÖ∏',
        'J':'üÖπ',
        'K':'üÖ∫',
        'L':'üÖª',
        'M':'üÖº',
        'N':'üÖΩ',
        'O':'üÖæ',
        'P':'üÖø',
        'Q':'üÜÄ',
        'R':'üÜÅ',
        'S':'üÜÇ',
        'T':'üÜÉ',
        'U':'üÜÑ',
        'V':'üÜÖ',
        'W':'üÜÜ',
        'X':'üÜá',
        'Y':'üÜà',
        'Z':'üÜâ'
    },
    "circle": {
        'a':'‚ìê',
        'b':'‚ìë',
        'c':'‚ìí',
        'd':'‚ìì',
        'e':'‚ìî',
        'f':'‚ìï',
        'g':'‚ìñ',
        'h':'‚ìó',
        'i':'‚ìò',
        'j':'‚ìô',
        'k':'‚ìö',
        'l':'‚ìõ',
        'm':'‚ìú',
        'n':'‚ìù',
        'o':'‚ìû',
        'p':'‚ìü',
        'q':'‚ì†',
        'r':'‚ì°',
        's':'‚ì¢',
        't':'‚ì£',
        'u':'‚ì§',
        'v':'‚ì•',
        'w':'‚ì¶',
        'x':'‚ìß',
        'y':'‚ì®',
        'z':'‚ì©',
        'A':'‚í∂',
        'B':'‚í∑',
        'C':'‚í∏',
        'D':'‚íπ',
        'E':'‚í∫',
        'F':'‚íª',
        'G':'‚íº',
        'H':'‚íΩ',
        'I':'‚íæ',
        'J':'‚íø',
        'K':'‚ìÄ',
        'L':'‚ìÅ',
        'M':'‚ìÇ',
        'N':'‚ìÉ',
        'O':'‚ìÑ',
        'P':'‚ìÖ',
        'Q':'‚ìÜ',
        'R':'‚ìá',
        'S':'‚ìà',
        'T':'‚ìâ',
        'U':'‚ìä',
        'V':'‚ìã',
        'W':'‚ìå',
        'X':'‚ìç',
        'Y':'‚ìé',
        'Z':'‚ìè'
    },
    "monospace": {
        'a':'ùöä',
        'b':'ùöã',
        'c':'ùöå',
        'd':'ùöç',
        'e':'ùöé',
        'f':'ùöè',
        'g':'ùöê',
        'h':'ùöë',
        'i':'ùöí',
        'j':'ùöì',
        'k':'ùöî',
        'l':'ùöï',
        'm':'ùöñ',
        'n':'ùöó',
        'o':'ùöò',
        'p':'ùöô',
        'q':'ùöö',
        'r':'ùöõ',
        's':'ùöú',
        't':'ùöù',
        'u':'ùöû',
        'v':'ùöü',
        'w':'ùö†',
        'x':'ùö°',
        'y':'ùö¢',
        'z':'ùö£',
        'A':'ùô∞',
        'B':'ùô±',
        'C':'ùô≤',
        'D':'ùô≥',
        'E':'ùô¥',
        'F':'ùôµ',
        'G':'ùô∂',
        'H':'ùô∑',
        'I':'ùô∏',
        'J':'ùôπ',
        'K':'ùô∫',
        'L':'ùôª',
        'M':'ùôº',
        'N':'ùôΩ',
        'O':'ùôæ',
        'P':'ùôø',
        'Q':'ùöÄ',
        'R':'ùöÅ',
        'S':'ùöÇ',
        'T':'ùöÉ',
        'U':'ùöÑ',
        'V':'ùöÖ',
        'W':'ùöÜ',
        'X':'ùöá',
        'Y':'ùöà',
        'Z':'ùöâ'
    },
    "canadian": {
        'a':'·ó©',
        'b':'·ó∑',
        'c':'·ëï',
        'd':'·ó™',
        'e':'E',
        'f':'·ñ¥',
        'g':'G',
        'h':'·ïº',
        'i':'I',
        'j':'·íç',
        'k':'K',
        'l':'·í™',
        'm':'·ó∞',
        'n':'·ëé',
        'o':'O',
        'p':'·ë≠',
        'q':'Q',
        'r':'·ñá',
        's':'S',
        't':'T',
        'u':'·ëå',
        'v':'·êØ',
        'w':'·óØ',
        'x':'·ô≠',
        'y':'Y',
        'z':'Z',
        'A':'·ó©',
        'B':'·ó∑',
        'C':'·ëï',
        'D':'·ó™',
        'E':'E',
        'F':'·ñ¥',
        'G':'G',
        'H':'·ïº',
        'I':'I',
        'J':'·íç',
        'K':'K',
        'L':'·í™',
        'M':'·ó∞',
        'N':'·ëé',
        'O':'O',
        'P':'·ë≠',
        'Q':'Q',
        'R':'·ñá',
        'S':'S',
        'T':'T',
        'U':'·ëå',
        'V':'·êØ',
        'W':'·óØ',
        'X':'·ô≠',
        'Y':'Y',
        'Z':'Z'
    },
    "fraktur": {
        'a':'ùñÜ',
        'b':'ùñá',
        'c':'ùñà',
        'd':'ùñâ',
        'e':'ùñä',
        'f':'ùñã',
        'g':'ùñå',
        'h':'ùñç',
        'i':'ùñé',
        'j':'ùñè',
        'k':'ùñê',
        'l':'ùñë',
        'm':'ùñí',
        'n':'ùñì',
        'o':'ùñî',
        'p':'ùñï',
        'q':'ùññ',
        'r':'ùñó',
        's':'ùñò',
        't':'ùñô',
        'u':'ùñö',
        'v':'ùñõ',
        'w':'ùñú',
        'x':'ùñù',
        'y':'ùñû',
        'z':'ùñü',
        'A':'ùï¨',
        'B':'ùï≠',
        'C':'ùïÆ',
        'D':'ùïØ',
        'E':'ùï∞',
        'F':'ùï±',
        'G':'ùï≤',
        'H':'ùï≥',
        'I':'ùï¥',
        'J':'ùïµ',
        'K':'ùï∂',
        'L':'ùï∑',
        'M':'ùï∏',
        'N':'ùïπ',
        'O':'ùï∫',
        'P':'ùïª',
        'Q':'ùïº',
        'R':'ùïΩ',
        'S':'ùïæ',
        'T':'ùïø',
        'U':'ùñÄ',
        'V':'ùñÅ',
        'W':'ùñÇ',
        'X':'ùñÉ',
        'Y':'ùñÑ',
        'Z':'ùñÖ'
    },
    "modifier": {
        'a':'·µÉ',
        'b':'·µá',
        'c':'·∂ú',
        'd':'·µà',
        'e':'·µâ',
        'f':'·∂†',
        'g':'·µç',
        'h':' ∞',
        'i':'‚Å±',
        'j':' ≤',
        'k':'·µè',
        'l':'À°',
        'm':'·µê',
        'n':'‚Åø',
        'o':'·µí',
        'p':'·µñ',
        'q':'q',
        'r':' ≥',
        's':'À¢',
        't':'·µó',
        'u':'·µò',
        'v':'·µõ',
        'w':' ∑',
        'x':'À£',
        'y':' ∏',
        'z':'·∂ª',
        'A':'·¥¨',
        'B':'·¥Æ',
        'C':'·∂ú',
        'D':'·¥∞',
        'E':'·¥±',
        'F':'·∂†',
        'G':'·¥≥',
        'H':'·¥¥',
        'I':'·¥µ',
        'J':'·¥∂',
        'K':'·¥∑',
        'L':'·¥∏',
        'M':'·¥π',
        'N':'·¥∫',
        'O':'·¥º',
        'P':'·¥æ',
        'Q':'Q',
        'R':'·¥ø',
        'S':'À¢',
        'T':'·µÄ',
        'U':'·µÅ',
        'V':'‚±Ω',
        'W':'·µÇ',
        'X':'À£',
        'Y':' ∏',
        'Z':'·∂ª'
    },
    "subscript": {
        'a':'‚Çê',
        'b':'b',
        'c':'c',
        'd':'d',
        'e':'‚Çë',
        'f':'f',
        'g':'g',
        'h':'‚Çï',
        'i':'·µ¢',
        'j':'‚±º',
        'k':'‚Çñ',
        'l':'‚Çó',
        'm':'‚Çò',
        'n':'‚Çô',
        'o':'‚Çí',
        'p':'‚Çö',
        'q':'q',
        'r':'·µ£',
        's':'‚Çõ',
        't':'‚Çú',
        'u':'·µ§',
        'v':'·µ•',
        'w':'w',
        'x':'‚Çì',
        'y':'y',
        'z':'z',
        'A':'‚Çê',
        'B':'B',
        'C':'C',
        'D':'D',
        'E':'‚Çë',
        'F':'F',
        'G':'G',
        'H':'‚Çï',
        'I':'·µ¢',
        'J':'‚±º',
        'K':'‚Çñ',
        'L':'‚Çó',
        'M':'‚Çò',
        'N':'‚Çô',
        'O':'‚Çí',
        'P':'‚Çö',
        'Q':'Q',
        'R':'·µ£',
        'S':'‚Çõ',
        'T':'‚Çú',
        'U':'·µ§',
        'V':'·µ•',
        'W':'W',
        'X':'‚Çì',
        'Y':'Y',
        'Z':'Z'
    },
    "italic": {
        'a':'ùò¢','b':'ùò£','c':'ùò§','d':'ùò•','e':'ùò¶','f':'ùòß','g':'ùò®','h':'ùò©','i':'ùò™',
        'j':'ùò´','k':'ùò¨','l':'ùò≠','m':'ùòÆ','n':'ùòØ','o':'ùò∞','p':'ùò±','q':'ùò≤','r':'ùò≥',
        's':'ùò¥','t':'ùòµ','u':'ùò∂','v':'ùò∑','w':'ùò∏','x':'ùòπ','y':'ùò∫','z':'ùòª',
        'A':'ùòà','B':'ùòâ','C':'ùòä','D':'ùòã','E':'ùòå','F':'ùòç','G':'ùòé','H':'ùòè','I':'ùòê',
        'J':'ùòë','K':'ùòí','L':'ùòì','M':'ùòî','N':'ùòï','O':'ùòñ','P':'ùòó','Q':'ùòò','R':'ùòô',
        'S':'ùòö','T':'ùòõ','U':'ùòú','V':'ùòù','W':'ùòû','X':'ùòü','Y':'ùò†','Z':'ùò°'
    },

    "double": {
        'a':'ùïí','b':'ùïì','c':'ùïî','d':'ùïï','e':'ùïñ','f':'ùïó','g':'ùïò','h':'ùïô','i':'ùïö',
        'j':'ùïõ','k':'ùïú','l':'ùïù','m':'ùïû','n':'ùïü','o':'ùï†','p':'ùï°','q':'ùï¢','r':'ùï£',
        's':'ùï§','t':'ùï•','u':'ùï¶','v':'ùïß','w':'ùï®','x':'ùï©','y':'ùï™','z':'ùï´',
        'A':'ùî∏','B':'ùîπ','C':'‚ÑÇ','D':'ùîª','E':'ùîº','F':'ùîΩ','G':'ùîæ','H':'‚Ñç','I':'ùïÄ',
        'J':'ùïÅ','K':'ùïÇ','L':'ùïÉ','M':'ùïÑ','N':'‚Ñï','O':'ùïÜ','P':'‚Ñô','Q':'‚Ñö','R':'‚Ñù',
        'S':'ùïä','T':'ùïã','U':'ùïå','V':'ùïç','W':'ùïé','X':'ùïè','Y':'ùïê','Z':'‚Ñ§'
        },
    "bypass": {
        'a':'–∞','b':'b','c':'—Å','d':'‘Å','e':'–µ','f':'f','g':'÷Å','h':'’∞','i':'—ñ','j':'—ò','k':'k','l':'”è','m':'m','n':'’∏','o':'÷Ö','p':'—Ä','q':'q','r':'r','s':'—ï','t':'t','u':'’Ω','v':'v','w':'·¥°','x':'—Ö','y':'—É','z':'‚¥≠','A':'–ê','B':'–í','C':'œπ','D':'ùñ£','E':'–ï','F':'ùñ•','G':'‘å','H':'Œó','I':'êå†','J':'–à','K':'K','L':'ùñ´','M':'ùñ¨','N':'ùñ≠','O':'’ï','P':'–†','Q':'Q','R':'ùñ±','S':'’è','T':'–¢','U':'’ç','V':'ùñµ','W':'‘ú','X':'Œß','Y':'Œ•','Z':'·Éç'
        },
    "normal": {
        'a':'a','b':'b','c':'c','d':'d','e':'e','f':'f','g':'g','h':'h','i':'i',
        'j':'j','k':'k','l':'l','m':'m','n':'n','o':'o','p':'p','q':'q','r':'r',
        's':'s','t':'t','u':'u','v':'v','w':'w','x':'x','y':'y','z':'z',
        'A':'A','B':'B','C':'C','D':'D','E':'E','F':'F','G':'G','H':'H','I':'I',
        'J':'J','K':'K','L':'L','M':'M','N':'N','O':'O','P':'P','Q':'Q','R':'R',
        'S':'S','T':'T','U':'U','V':'V','W':'W','X':'X','Y':'Y','Z':'Z'
       },
     "smallcaps": {
        'a':'·¥Ä','b':' ô','c':'·¥Ñ','d':'·¥Ö','e':'·¥á','f':'Íú∞','g':'…¢','h':' ú','i':'…™',
        'j':'·¥ä','k':'·¥ã','l':' ü','m':'·¥ç','n':'…¥','o':'·¥è','p':'·¥ò','q':'«´','r':' Ä',
        's':'Íú±','t':'·¥õ','u':'·¥ú','v':'·¥†','w':'·¥°','x':'x','y':' è','z':'·¥¢',
        'A':'·¥Ä','B':' ô','C':'·¥Ñ','D':'·¥Ö','E':'·¥á','F':'Íú∞','G':'…¢','H':' ú','I':'…™',
        'J':'·¥ä','K':'·¥ã','L':' ü','M':'·¥ç','N':'…¥','O':'·¥è','P':'·¥ò','Q':'«´','R':' Ä',
        'S':'Íú±','T':'·¥õ','U':'·¥ú','V':'·¥†','W':'·¥°','X':'x','Y':' è','Z':'·¥¢'
    }
}

# --------------------------------------------------------------------------- #
# 2.  Pick a set                                                              #
# --------------------------------------------------------------------------- #
def pick_set():
    names = list(MASTER)
    while True:
        print("Sets:", ", ".join(names))
        choice = input("Which set? > ").strip()
        if choice in MASTER:
            return MASTER[choice]
        print("‚ùå  unknown ‚Äì try again")

# --------------------------------------------------------------------------- #
# 3.  Crash logger                                                            #
# --------------------------------------------------------------------------- #
def log_exc():
    with LOG_FILE.open("a", encoding="utf-8") as f:
        f.write("-" * 60 + "\n")
        f.write(time.strftime("%Y-%m-%d %H:%M:%S") + "\n")
        traceback.print_exc(file=f)

# --------------------------------------------------------------------------- #
# 4.  Clipboard fallback                                                      #
# --------------------------------------------------------------------------- #
try:
    import pyperclip
    def paste_unicode(text):
        pyperclip.copy(text)
        import pynput.keyboard as kb
        kb.Controller().press(kb.Key.ctrl)
        kb.Controller().press('v')
        kb.Controller().release('v')
        kb.Controller().release(kb.Key.ctrl)
except Exception:
    # no clipboard ‚Äì ignore
    def paste_unicode(text):
        pass
# --------------------------------------------------------------------------- #
# 5.  Main driver  ‚Äì uses `keyboard` library                                  #
# --------------------------------------------------------------------------- #
def main():
    table  = pick_set()
    active = True
    import keyboard                       # <- new library
    import threading

    def replace_one(char):
        """Inject the replacement character."""
        keyboard.send('backspace')         # remove original letter
        keyboard.write(char)               # send bold/italic/‚Ä¶

    # callback that runs inside keyboard‚Äôs hook
    def handler(event):
        nonlocal active
        if keyboard.is_pressed('pause'):   # ON / OFF toggle
            active = not active
            print('active =', active)
            return True                    # let pause through
        if not active or event.is_keypad:
            return True                    # let key through

        c = event.name                     # 'a', 'b', 'shift+a' ‚Ä¶
        if len(c) == 1 and c.isascii() and c.isalpha():
            repl = table.get(c)
            if repl:                       # we want to replace
                # do the replacement *after* this callback returns
                threading.Thread(target=replace_one, args=(repl,), daemon=True).start()
                return False               # suppress original
        return True                        # let anything else through

    print('Running ‚Äì Pause/Break toggles ‚Äì Ctrl-C quits.')
    keyboard.hook(handler)                 # install low-level hook
    keyboard.wait('ctrl+c')                # keep running till Ctrl-C
    keyboard.unhook_all()
    print('\nBye!')

# --------------------------------------------------------------------------- #
# 6.  Entry point                                                             #
# --------------------------------------------------------------------------- #
if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\nBye!")
    except Exception:
        log_exc()
        print("\nüî•  CRASH ‚Äì details in", LOG_FILE)
        input("Press Enter to exit‚Ä¶")
